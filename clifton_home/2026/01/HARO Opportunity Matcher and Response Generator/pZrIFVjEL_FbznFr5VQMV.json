{"updatedAt":"2026-02-11T20:30:45.576Z","createdAt":"2026-01-26T20:17:07.127Z","id":"pZrIFVjEL_FbznFr5VQMV","name":"HARO Opportunity Matcher and Response Generator","description":null,"active":true,"isArchived":false,"nodes":[{"parameters":{"pollTimes":{"item":[{"hour":5,"minute":30},{"hour":12,"minute":30},{"hour":17,"minute":30}]},"filters":{"sender":"haro@helpareporter.com"}},"id":"39fcfa0e-8701-426d-a234-a9eea017a2f9","name":"Watch for HARO Emails","type":"n8n-nodes-base.gmailTrigger","typeVersion":1.3,"position":[272,432],"credentials":{"gmailOAuth2":{"id":"UfGdgK49wgVcM0yE","name":"Zac Gmail"}}},{"parameters":{"operation":"executeQuery","query":"SELECT email_id FROM processed_haro_emails","options":{}},"id":"43102571-db4a-4368-8a12-ef1e2a19428b","name":"Get Processed HARO Email IDs","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[560,592],"alwaysOutputData":true,"credentials":{"postgres":{"id":"dXDqCSpSeQj6nWD4","name":"Neon Home DB"}}},{"parameters":{"mode":"chooseBranch"},"id":"14ba88a3-c80b-4593-a162-f521c52aaf41","name":"Wait for Email Data and DB","type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[784,448]},{"parameters":{"promptType":"define","text":"=Here is the HARO email content to analyze:\n\n{{ $json.html }}","hasOutputParser":true,"options":{"systemMessage":"You are an expert at analyzing HARO (Help A Reporter Out) emails to identify opportunities for subject matter experts.\n\nYour task is to:\n1. Read the HARO email content carefully\n2. Identify any queries where the following expertise would be valuable:\n   - Kubernetes and software infrastructure\n   - Enterprise software architecture\n   - Software development and SaaS products\n   - Business automation at scale\n   - AI automation for businesses\n   - Private aviation/piloting\n   - Location-specific: Louisville, Kentucky\n\n3. For each relevant opportunity, extract:\n   - The reporter's query/request\n   - Why this person's expertise matches\n   - The deadline (if mentioned)\n   - Contact information for the reporter\n\n4. Only return opportunities that are a strong match for the expertise areas listed above\n5. If no relevant opportunities are found, return an empty array\n\nReturn your findings in the structured format defined by the output parser."}},"id":"137b8aba-8851-4710-b001-858da3a50e45","name":"Analyze HARO Opportunities","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[1600,-144]},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"opportunities\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"query\": {\n            \"type\": \"string\"\n          },\n          \"matchReason\": {\n            \"type\": \"string\"\n          },\n          \"deadline\": {\n            \"type\": \"string\"\n          },\n          \"contactInfo\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"hasRelevantOpportunities\": {\n      \"type\": \"boolean\"\n    }\n  }\n}"},"id":"d58833bf-22a5-4315-8eb7-0fd141c9c53a","name":"Structure Opportunity Data","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[1968,160]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"id-1","leftValue":"={{ $json.output.opportunities.length }}","rightValue":1,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"options":{}},"id":"3726c185-749a-4e85-bc03-31d5932cd3a4","name":"Found Relevant Opportunities?","type":"n8n-nodes-base.if","typeVersion":2.3,"position":[1904,-176]},{"parameters":{"promptType":"define","text":"=Opportunity: {{ $json.query }}\n\nWhy I match: {{ $json.matchReason }}\n\nDeadline: {{ $json.deadline }}\n\nContact: {{ $json.contactInfo }}","hasOutputParser":true,"options":{"systemMessage":"You are an expert at crafting professional, compelling responses to HARO (Help A Reporter Out) queries. Your goal is to craft responses that reporters will actually use — conversational, genuinely helpful, and easy to quote.                                          \n                                                                                                                                                                                                                                                                            \n  Your Task                                                                                                                                                                                                                                                                 \n\n  1. Review the opportunity details provided\n  2. Identify what type of query the reporter is making (quote, interview source, or data/case study)\n  3. Draft a response using the appropriate strategy below\n  4. Ensure the response introduces the expert, explains relevant expertise, provides a thoughtful answer, and offers to provide additional information\n\n  About the Expert\n\n  - Kubernetes and software infrastructure specialist\n  - Enterprise software architect\n  - Software developer and SaaS founder\n  - Private pilot\n  - Based in Louisville, Kentucky\n  - Business automation at scale specialist\n  - AI automation consultant for businesses\n\n  IMPORTANT: The expert's day job is under NDA — NEVER mention Waystar or reference a day job employer. You CAN and SHOULD mention the expert's own businesses and side ventures by name when relevant. Frame the expert through their own work, not their employer.\n\n  Dual-Audience Awareness\n\n  Reporters write for a general audience, but they need technically credible sources. Your response must work on two levels:\n  - The outside (general audience): Explain technical concepts in plain language. Use analogies and real-world examples. Assume the person reading has zero technical knowledge. If the query is about infrastructure, AI, or software — translate it into terms anyone can\n  understand.\n  - The inside (technical credibility): Show enough depth that the reporter trusts you actually know what you're talking about. Reference specific technologies, methodologies, or outcomes — but always follow up with what it means in plain English.\n\n  The goal: a reporter with no tech background should understand every word, while a technical reader should recognize genuine expertise behind it.\n\n  Response Strategy — Adapt to Query Type\n\n  If the reporter is looking for a quote or expert opinion:\n  - Open with a punchy, quotable 1-2 sentence statement that directly answers their question\n  - Follow with a brief supporting explanation (2-3 sentences)\n  - Close with a one-liner offering to elaborate\n\n  If the reporter is looking for an expert source to interview:\n  - Open with a concise intro: who you are and why you're relevant to this topic\n  - Provide 2-3 concrete talking points you could expand on in an interview\n  - Close with availability and preferred contact method\n\n  If the reporter is looking for data, examples, or a case study:\n  - Lead with the specific data point, example, or story that matches their request\n  - Provide context around it (what happened, why it matters)\n  - Offer to share more details or connect for follow-up\n\n  Pitching Guidelines (MUST FOLLOW)\n\n  - Keep it under 200 words — reporters skip long emails, be ruthlessly concise\n  - Include credentials and links — mention relevant titles, company names, portfolio URLs, LinkedIn, or published work that establishes authority on the topic\n\n  Tone & Style Rules\n\n  - Conversational and human — write like a real person, not a press release\n  - No corporate jargon or buzzwords (avoid \"leverage\", \"synergy\", \"thought leader\")\n  - Be genuinely helpful to the reporter, not self-promotional\n  - Use first person (\"I\", \"my team\", \"we built\")\n  - Keep it scannable — reporters read hundreds of these, shorter is better\n\n  Your tone should be very concise and informational and explain technical things in clear language. Assume that the person reading has no technical knowledge that I do.\n\n  Format\n\n  Return a JSON object with three fields:\n  - to: the reporter email that we need to respond to\n  - subject: Extract the query title — use the text that appears BEFORE the first \":\" in the opportunity query. Use that exact text as the subject line, nothing else. Subject must include due datetime.\n  - message: The email body in HTML. Use <p> tags for paragraphs, <a> tags for links, and <br> for line breaks. Do NOT use bullet points, unordered lists, ordered lists, or dashes. Write in flowing paragraph form throughout. Structure the message as follows:\n\n  Section 1 — Direct answer to the query. Start here with no greeting. Write 2-4 sentences in a single <p> tag that directly address what the reporter is asking. Be conversational and genuinely helpful.\n\n  Section 2 — Credentials paragraph. Use this EXACT text in a <p> tag (do NOT paraphrase or omit any part):\n  I'm Zac Clifton, Senior DevOps Engineer at Waystar (2,000+ employees), leading enterprise software infrastructure systems in Healthcare. I cannot speak about Waystar specifically as I am under an NDA, however I can speak to generals about the industry. In-depth skills in: Kubernetes/infrastructure, enterprise software architecture, SaaS founding, AI automation at scale.<br><a href=\"https://www.linkedin.com/in/cliftonz/\">LinkedIn</a> | <a href=\"https://dev.to/cliftonz\">Articles</a>\n\n  Section 3 — Availability. Use this EXACT text in a <p> tag:\n  Available Monday through Saturday, 8am–8pm EST.<br>Best contact: <a href=\"mailto:zac16530@gmail.com\">zac16530@gmail.com</a> | 502-794-3201\n\n  IMPORTANT: Always include the credentials block and contact info EXACTLY as written above at the end of every message. Do not omit or paraphrase it. No signature block beyond the contact info. Output must be valid HTML — no markdown, no plain text formatting.\n"}},"id":"a8e48ab2-b13c-4955-88b1-248e0eb025bc","name":"Generate Response Draft","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[2768,-176]},{"parameters":{"model":{"__rl":true,"value":"gpt-5","mode":"list","cachedResultName":"gpt-5"},"builtInTools":{"webSearch":{"searchContextSize":"high"}},"options":{}},"id":"586d4c0a-c228-48c6-baad-c12e54470fad","name":"OpenAI GPT-4 for Response","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[2768,240],"credentials":{"openAiApi":{"id":"QIZjLJ92uPOcCDE8","name":"OpenAi account"}}},{"parameters":{"schema":{"__rl":true,"mode":"name","value":"public"},"table":{"__rl":true,"mode":"name","value":"processed_haro_emails"},"columns":{"mappingMode":"defineBelow","value":{"processed_at":"={{ $now }}","email_id":"=${{ $('Get a message').item.json.id }}"},"matchingColumns":[],"schema":[{"id":"email_id","displayName":"email_id","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"processed_at","displayName":"processed_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"a3dc5dec-dbfb-4c73-89d2-a3a62cb88208","name":"Mark Email as Processed","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[2928,432],"executeOnce":true,"credentials":{"postgres":{"id":"dXDqCSpSeQj6nWD4","name":"Neon Home DB"}}},{"parameters":{"jsCode":"// Get emails from the trigger\nconst emails = $(\"Watch for HARO Emails\").all();\n\n// Get processed email IDs from database\nconst processedEmailIds = $(\"Get Processed HARO Email IDs\").all().map(item => item.json.email_id);\n\n// Filter out emails whose id exists in the processed list\nconst unprocessedEmails = emails.filter(email => {\n  return !processedEmailIds.includes(email.json.id);\n});\n\nreturn unprocessedEmails;"},"id":"dd6b9604-b3f8-4d1f-abd5-dc99f720f925","name":"Filter Unprocessed Emails","type":"n8n-nodes-base.code","typeVersion":2,"position":[1008,448]},{"parameters":{"operation":"get","messageId":"={{ $json.id }}","simple":false,"options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[1232,448],"id":"2fa7429d-2076-4b45-b9d6-cc6bd1cedf34","name":"Get a message","webhookId":"8fee9b57-c868-4fd7-8a34-d4cb49402450","credentials":{"gmailOAuth2":{"id":"UfGdgK49wgVcM0yE","name":"Zac Gmail"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-5.2","mode":"list","cachedResultName":"gpt-5.2"},"builtInTools":{},"options":{}},"id":"b365870f-ca2d-4264-8b2b-f419a67bb069","name":"OpenAI GPT-5.2","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[1520,144],"credentials":{"openAiApi":{"id":"QIZjLJ92uPOcCDE8","name":"OpenAi account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[2368,-192],"id":"dd1a416c-6066-4c5b-a8b1-576d25a8606f","name":"Loop Over Items"},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"to\": {\n    \"type\": \"string\"\n  },\n  \"subject\": {\n    \"type\": \"string\"\n  },\n  \"message\": {\n    \"type\": \"string\"\n  }\n}","autoFix":true},"id":"28d4474f-b2b1-4e59-84b7-f34a934757aa","name":"Structure Opportunity Data1","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[2944,48]},{"parameters":{"jsCode":"const twentyFourHoursFromNow = new Date(Date.now() + 24 * 60 * 60 * 1000);\n\nreturn $input.all().flatMap(item =>\n  (item.json.output.opportunities || [])\n    .filter(opp => {\n      if (!opp.deadline) return true;\n      const dl = new Date(opp.deadline);\n      // Keep only if deadline is invalid (unparseable) or more than 24h away\n      return isNaN(dl.getTime()) || dl >= twentyFourHoursFromNow;\n    })\n    .map(opp => ({ json: opp }))\n);"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2128,-192],"id":"f367ead7-417c-4cec-887b-c6e6e6d52eee","name":"Split Out Opportunities"},{"parameters":{"content":"## Workflow Overview\n\nThis workflow watches for HARO emails, analyzes them for matching opportunities using AI + pgvector feedback history, drafts personalized responses, stores embeddings for future learning, and creates Gmail drafts with feedback links.\n\nSee **DB Setup Note1** for database setup SQL.","height":680,"width":420,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-256,352],"id":"7248fbbd-f2de-41ce-90f0-a0fcb8184b59","name":"DB Setup Note"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[1664,304],"id":"35302038-94ff-42a3-9ab4-52985d8d5beb","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"QIZjLJ92uPOcCDE8","name":"OpenAi account"}}},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"This tool has the feedback of past oppurtunities and \nquery, contact, match reason, generated response, 1536-dim embedding, and your good/bad/pending feedback rating","tableName":"haro_opportunity_vectors","options":{"columnNames":{"values":{}},"metadata":{"metadataValues":[{"name":"=user_email","value":"={{ $json.to }}"}]}}},"type":"@n8n/n8n-nodes-langchain.vectorStorePGVector","typeVersion":1.3,"position":[1664,160],"id":"8e098ba4-acd7-47ce-b5be-0946545d4af7","name":"Postgres PGVector Store","credentials":{"postgres":{"id":"64vfs383hTo0m8pr","name":"NeonDB HBF account"}}},{"parameters":{"jsCode":"const crypto = require('crypto');\nconst item = $json;\nconst emailId = $('Get a message').first().json.id;\nconst userEmail = $('Get a message').first().json.to || 'default';\nconst oppId = crypto.randomUUID();\n\nreturn [{\n  json: {\n    pageContent: item.query,\n    metadata: {\n      opportunity_id: oppId,\n      user_email: userEmail,\n      match_reason: item.matchReason,\n      deadline: item.deadline,\n      contact_info: item.contactInfo,\n      email_id: emailId,\n      generated_subject: item.output ? item.output.subject : '',\n      generated_message: item.output ? item.output.message : '',\n      feedback_rating: null\n    }\n  }\n}];"},"id":"2f9efc9c-5b14-440b-8d49-d2400a0afb13","name":"Prepare Document","type":"n8n-nodes-base.code","typeVersion":2,"position":[3088,-176]},{"parameters":{"model":"text-embedding-3-small","options":{}},"id":"e432adb0-9b92-4ef7-babe-4e7592fab861","name":"OpenAI Embeddings Storage","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[3280,32],"credentials":{"openAiApi":{"id":"QIZjLJ92uPOcCDE8","name":"OpenAi account"}}},{"parameters":{"resource":"draft","subject":"={{ $('Generate Response Draft').item.json.output.subject }}","emailType":"html","message":"={{ $('Generate Response Draft').item.json.output.message }}<hr style=\"margin:24px 0;border:none;border-top:1px solid #ddd\"><p style=\"margin:0 0 12px;font-size:14px;color:#555\">Rate this match:</p><p style=\"margin:0\"><a href=\"https://n8n.clifton.quest/form/21899513-a885-4f3f-8de3-0ab3d7c76440?Opportunity+ID={{ $('Prepare Document').item.json.metadata.opportunity_id }}&Rating=1\" style=\"display:inline-block;padding:10px 24px;margin-right:12px;background:#22c55e;color:#fff;text-decoration:none;border-radius:6px;font-weight:600;font-size:14px\">Good Match</a><a href=\"https://n8n.clifton.quest/form/21899513-a885-4f3f-8de3-0ab3d7c76440?Opportunity+ID={{ $('Prepare Document').item.json.metadata.opportunity_id }}&Rating=-1\" style=\"display:inline-block;padding:10px 24px;background:#ef4444;color:#fff;text-decoration:none;border-radius:6px;font-weight:600;font-size:14px\">Bad Match</a></p>","options":{"sendTo":"={{ $('Generate Response Draft').item.json.output.To }}"}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[3760,-176],"id":"766d8188-861c-4507-aed2-5084abe5071c","name":"Create a draft1","webhookId":"8e0302c3-6e7b-4b25-90f6-cae272985fe5","executeOnce":true,"credentials":{"gmailOAuth2":{"id":"UfGdgK49wgVcM0yE","name":"Zac Gmail"}}},{"parameters":{"mode":"insert","tableName":"haro_opportunity_vectors","options":{}},"id":"39ddc186-43d0-41d3-b5c0-dfadfa576567","name":"Store Opportunity1","type":"@n8n/n8n-nodes-langchain.vectorStorePGVector","typeVersion":1,"position":[3296,-176],"credentials":{"postgres":{"id":"dXDqCSpSeQj6nWD4","name":"Neon Home DB"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[3472,32],"id":"7df72802-1b52-4907-a38a-8fef1409bf73","name":"Default Data Loader"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"bda05279-3af9-414c-bfcf-49e9f5e99eaf","leftValue":"={{ $('Split Out Opportunities').all().length }}","rightValue":0,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[3104,432],"id":"25d86160-54ea-4cac-aa97-b4d7b86eb7d8","name":"If"},{"parameters":{"authentication":"webhook","content":"=Found ${{ $('Split Out Opportunities').all().length }} haro oppurtunities.","options":{}},"type":"n8n-nodes-base.discord","typeVersion":2,"position":[3344,416],"id":"97512959-18ea-4297-9605-91bb5da8b8e7","name":"Discord","webhookId":"b76b3eb6-f02f-464c-8b45-23023a290e4f","credentials":{"discordWebhookApi":{"id":"itxZeAJbs9N1NxYG","name":"Zac Information Channel"}}},{"parameters":{"content":"## Vector Store: HARO Opportunity Memory\n\nUses n8n's PGVector Vector Store node with OpenAI text-embedding-3-small. Every matched opportunity is embedded and stored in the `haro_opportunity_vectors` table (auto-managed by n8n). Per-user segmentation via `user_email` in metadata (from Gmail address).\n\nWhen a new HARO email arrives, the workflow finds similar past opportunities via vector similarity. Ones with feedback are injected into the analysis prompt as calibration examples.\n\n**Metadata stored per opportunity:**\n- opportunity_id (uuid, for feedback links)\n- user_email (Gmail address, per-user filtering)\n- match_reason, deadline, contact_info\n- generated_subject, generated_message\n- feedback_rating: 1=good, -1=bad, null=pending\n\n---\n\n## Database Setup (run against Neon Home DB)\n\n```sql\nCREATE EXTENSION IF NOT EXISTS vector;\n\nCREATE TABLE IF NOT EXISTS processed_haro_emails (\n  email_id TEXT PRIMARY KEY,\n  processed_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- haro_opportunity_vectors is auto-created by\n-- the PGVector Vector Store node on first insert.\n-- Run these indexes AFTER the first insert:\n\nCREATE INDEX IF NOT EXISTS haro_vectors_user_email_idx\n  ON haro_opportunity_vectors\n  ((metadata->>'user_email'));\n\nCREATE INDEX IF NOT EXISTS haro_vectors_feedback_idx\n  ON haro_opportunity_vectors\n  ((metadata->>'feedback_rating'))\n  WHERE metadata->>'feedback_rating' IS NOT NULL;\n```","height":904,"width":596,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-560,1120],"id":"926ce6dc-1656-4333-bbca-c5d7ff5a301b","name":"DB Setup Note1"},{"parameters":{"minutesSaved":20},"type":"n8n-nodes-base.timeSaved","typeVersion":1,"position":[4000,-176],"id":"bc589a1f-5e01-4b39-bce9-37e2c28ccec1","name":"Time Saved"},{"parameters":{"content":"# Note\n\nexecutes top to bottom"},"type":"n8n-nodes-base.stickyNote","position":[1200,-256],"typeVersion":1,"id":"d04dadf2-1493-475e-82a6-090025fffc17","name":"Sticky Note"},{"parameters":{"mode":"chooseBranch","useDataOfInput":2},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[2736,432],"id":"6e18ca4b-379f-4d09-8cc3-7e6ff7fdaaea","name":"Merge"}],"connections":{"Watch for HARO Emails":{"main":[[{"node":"Wait for Email Data and DB","type":"main","index":0},{"node":"Get Processed HARO Email IDs","type":"main","index":0}]]},"Get Processed HARO Email IDs":{"main":[[{"node":"Wait for Email Data and DB","type":"main","index":1}]]},"Wait for Email Data and DB":{"main":[[{"node":"Filter Unprocessed Emails","type":"main","index":0}]]},"Analyze HARO Opportunities":{"main":[[{"node":"Found Relevant Opportunities?","type":"main","index":0}]]},"Structure Opportunity Data":{"ai_outputParser":[[{"node":"Analyze HARO Opportunities","type":"ai_outputParser","index":0}]]},"Found Relevant Opportunities?":{"main":[[{"node":"Split Out Opportunities","type":"main","index":0}]]},"Generate Response Draft":{"main":[[{"node":"Prepare Document","type":"main","index":0}]]},"OpenAI GPT-4 for Response":{"ai_languageModel":[[{"node":"Generate Response Draft","type":"ai_languageModel","index":0},{"node":"Structure Opportunity Data1","type":"ai_languageModel","index":0}]]},"Filter Unprocessed Emails":{"main":[[{"node":"Get a message","type":"main","index":0}]]},"Get a message":{"main":[[{"node":"Analyze HARO Opportunities","type":"main","index":0},{"node":"Merge","type":"main","index":1}]]},"OpenAI GPT-5.2":{"ai_languageModel":[[{"node":"Analyze HARO Opportunities","type":"ai_languageModel","index":0}]]},"Loop Over Items":{"main":[[{"node":"Merge","type":"main","index":0}],[{"node":"Generate Response Draft","type":"main","index":0}]]},"Structure Opportunity Data1":{"ai_outputParser":[[{"node":"Generate Response Draft","type":"ai_outputParser","index":0}]]},"Split Out Opportunities":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Postgres PGVector Store":{"ai_tool":[[{"node":"Analyze HARO Opportunities","type":"ai_tool","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Postgres PGVector Store","type":"ai_embedding","index":0}]]},"Prepare Document":{"main":[[{"node":"Store Opportunity1","type":"main","index":0}]]},"OpenAI Embeddings Storage":{"ai_embedding":[[{"node":"Store Opportunity1","type":"ai_embedding","index":0}]]},"Create a draft1":{"main":[[{"node":"Time Saved","type":"main","index":0}]]},"Store Opportunity1":{"main":[[{"node":"Create a draft1","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Store Opportunity1","type":"ai_document","index":0}]]},"Mark Email as Processed":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Discord","type":"main","index":0}]]},"Time Saved":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Mark Email as Processed","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","binaryMode":"separate","availableInMCP":false,"timeSavedMode":"dynamic","errorWorkflow":"lumsfsJn-11VSs7gepTrz","callerPolicy":"workflowsFromSameOwner","timeSavedPerExecution":60},"staticData":{"node:Watch for HARO Emails":{"Watch for HARO Emails":{"lastTimeChecked":1770830637,"possibleDuplicates":["19c4dbb2d7dbdee3","19c4c3a0e43d8665"]}}},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"6e581a8d-cc4b-479b-ae42-a55adda9f630","activeVersionId":"01abc32d-06a3-46aa-a509-792569e8bed2","versionCounter":445,"triggerCount":1,"shared":[{"updatedAt":"2026-01-26T20:17:07.127Z","createdAt":"2026-01-26T20:17:07.127Z","role":"workflow:owner","workflowId":"pZrIFVjEL_FbznFr5VQMV","projectId":"IbSEWMWujt4v9pwR","project":{"updatedAt":"2026-01-20T02:36:13.950Z","createdAt":"2025-12-27T17:56:55.369Z","id":"IbSEWMWujt4v9pwR","name":"Zac Clifton <zac16530@gmail.com>","type":"personal","icon":null,"description":null,"creatorId":"ec0e00c1-c94c-415c-8a06-1d74c6c63f94","projectRelations":[{"updatedAt":"2025-12-27T17:56:55.369Z","createdAt":"2025-12-27T17:56:55.369Z","userId":"ec0e00c1-c94c-415c-8a06-1d74c6c63f94","projectId":"IbSEWMWujt4v9pwR","user":{"updatedAt":"2026-02-11T08:33:04.193Z","createdAt":"2025-12-27T17:56:53.886Z","id":"ec0e00c1-c94c-415c-8a06-1d74c6c63f94","email":"zac16530@gmail.com","firstName":"Zac","lastName":"Clifton","personalizationAnswers":{"version":"v4","personalization_survey_submitted_at":"2025-12-27T17:58:17.859Z","personalization_survey_n8n_version":"2.2.1"},"settings":{"userActivated":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"MsLT810d05Z0WgATw251C","userActivatedAt":1768898015272,"npsSurvey":{"waitingForResponse":true,"ignoredCount":2,"lastShownAt":1770390580432}},"disabled":false,"mfaEnabled":true,"lastActiveAt":"2026-02-11","isPending":false}}]}}],"tags":[],"activeVersion":{"updatedAt":"2026-02-11T20:13:17.758Z","createdAt":"2026-02-11T20:13:05.630Z","versionId":"01abc32d-06a3-46aa-a509-792569e8bed2","workflowId":"pZrIFVjEL_FbznFr5VQMV","nodes":[{"parameters":{"pollTimes":{"item":[{"hour":5,"minute":30},{"hour":12,"minute":30},{"hour":17,"minute":30}]},"filters":{"sender":"haro@helpareporter.com"}},"id":"0bc4b55d-09a4-47b3-a07e-14b1aa755c3c","name":"Watch for HARO Emails","type":"n8n-nodes-base.gmailTrigger","typeVersion":1.3,"position":[560,-64],"credentials":{"gmailOAuth2":{"id":"UfGdgK49wgVcM0yE","name":"Zac Gmail"}}},{"parameters":{"operation":"executeQuery","query":"SELECT email_id FROM processed_haro_emails","options":{}},"id":"15bd756a-1f3a-48ac-a4be-b8809433e926","name":"Get Processed HARO Email IDs","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[848,96],"alwaysOutputData":true,"credentials":{"postgres":{"id":"dXDqCSpSeQj6nWD4","name":"Neon Home DB"}}},{"parameters":{"mode":"chooseBranch"},"id":"d4218b97-ab88-42d4-a0a5-0125c7d61151","name":"Wait for Email Data and DB","type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1072,-48]},{"parameters":{"promptType":"define","text":"=Here is the HARO email content to analyze:\n\n{{ $json.html }}","hasOutputParser":true,"options":{"systemMessage":"You are an expert at analyzing HARO (Help A Reporter Out) emails to identify opportunities for subject matter experts.\n\nYour task is to:\n1. Read the HARO email content carefully\n2. Identify any queries where the following expertise would be valuable:\n   - Kubernetes and software infrastructure\n   - Enterprise software architecture\n   - Software development and SaaS products\n   - Business automation at scale\n   - AI automation for businesses\n   - Private aviation/piloting\n   - Location-specific: Louisville, Kentucky\n\n3. For each relevant opportunity, extract:\n   - The reporter's query/request\n   - Why this person's expertise matches\n   - The deadline (if mentioned)\n   - Contact information for the reporter\n\n4. Only return opportunities that are a strong match for the expertise areas listed above\n5. If no relevant opportunities are found, return an empty array\n\nReturn your findings in the structured format defined by the output parser."}},"id":"1d4bdef1-e2db-4f4e-b814-37f617b86709","name":"Analyze HARO Opportunities","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[1888,-640]},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"type\": \"object\",\n  \"properties\": {\n    \"opportunities\": {\n      \"type\": \"array\",\n      \"items\": {\n        \"type\": \"object\",\n        \"properties\": {\n          \"query\": {\n            \"type\": \"string\"\n          },\n          \"matchReason\": {\n            \"type\": \"string\"\n          },\n          \"deadline\": {\n            \"type\": \"string\"\n          },\n          \"contactInfo\": {\n            \"type\": \"string\"\n          }\n        }\n      }\n    },\n    \"hasRelevantOpportunities\": {\n      \"type\": \"boolean\"\n    }\n  }\n}"},"id":"81dd284b-4cfd-4a1f-ba86-3516f4752427","name":"Structure Opportunity Data","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[2256,-336]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"id-1","leftValue":"={{ $json.output.opportunities.length }}","rightValue":1,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"options":{}},"id":"d31ebe57-a61e-41ff-bdbe-57e30237782b","name":"Found Relevant Opportunities?","type":"n8n-nodes-base.if","typeVersion":2.3,"position":[2192,-672]},{"parameters":{"promptType":"define","text":"=Opportunity: {{ $json.query }}\n\nWhy I match: {{ $json.matchReason }}\n\nDeadline: {{ $json.deadline }}\n\nContact: {{ $json.contactInfo }}","hasOutputParser":true,"options":{"systemMessage":"You are an expert at crafting professional, compelling responses to HARO (Help A Reporter Out) queries. Your goal is to craft responses that reporters will actually use — conversational, genuinely helpful, and easy to quote.                                          \n                                                                                                                                                                                                                                                                            \n  Your Task                                                                                                                                                                                                                                                                 \n\n  1. Review the opportunity details provided\n  2. Identify what type of query the reporter is making (quote, interview source, or data/case study)\n  3. Draft a response using the appropriate strategy below\n  4. Ensure the response introduces the expert, explains relevant expertise, provides a thoughtful answer, and offers to provide additional information\n\n  About the Expert\n\n  - Kubernetes and software infrastructure specialist\n  - Enterprise software architect\n  - Software developer and SaaS founder\n  - Private pilot\n  - Based in Louisville, Kentucky\n  - Business automation at scale specialist\n  - AI automation consultant for businesses\n\n  IMPORTANT: The expert's day job is under NDA — NEVER mention Waystar or reference a day job employer. You CAN and SHOULD mention the expert's own businesses and side ventures by name when relevant. Frame the expert through their own work, not their employer.\n\n  Dual-Audience Awareness\n\n  Reporters write for a general audience, but they need technically credible sources. Your response must work on two levels:\n  - The outside (general audience): Explain technical concepts in plain language. Use analogies and real-world examples. Assume the person reading has zero technical knowledge. If the query is about infrastructure, AI, or software — translate it into terms anyone can\n  understand.\n  - The inside (technical credibility): Show enough depth that the reporter trusts you actually know what you're talking about. Reference specific technologies, methodologies, or outcomes — but always follow up with what it means in plain English.\n\n  The goal: a reporter with no tech background should understand every word, while a technical reader should recognize genuine expertise behind it.\n\n  Response Strategy — Adapt to Query Type\n\n  If the reporter is looking for a quote or expert opinion:\n  - Open with a punchy, quotable 1-2 sentence statement that directly answers their question\n  - Follow with a brief supporting explanation (2-3 sentences)\n  - Close with a one-liner offering to elaborate\n\n  If the reporter is looking for an expert source to interview:\n  - Open with a concise intro: who you are and why you're relevant to this topic\n  - Provide 2-3 concrete talking points you could expand on in an interview\n  - Close with availability and preferred contact method\n\n  If the reporter is looking for data, examples, or a case study:\n  - Lead with the specific data point, example, or story that matches their request\n  - Provide context around it (what happened, why it matters)\n  - Offer to share more details or connect for follow-up\n\n  Pitching Guidelines (MUST FOLLOW)\n\n  - Keep it under 200 words — reporters skip long emails, be ruthlessly concise\n  - Include credentials and links — mention relevant titles, company names, portfolio URLs, LinkedIn, or published work that establishes authority on the topic\n\n  Tone & Style Rules\n\n  - Conversational and human — write like a real person, not a press release\n  - No corporate jargon or buzzwords (avoid \"leverage\", \"synergy\", \"thought leader\")\n  - Be genuinely helpful to the reporter, not self-promotional\n  - Use first person (\"I\", \"my team\", \"we built\")\n  - Keep it scannable — reporters read hundreds of these, shorter is better\n\n  Your tone should be very concise and informational and explain technical things in clear language. Assume that the person reading has no technical knowledge that I do.\n\n  Format\n\n  Return a JSON object with three fields:\n  - to: the reporter email that we need to respond to\n  - subject: Extract the query title — use the text that appears BEFORE the first \":\" in the opportunity query. Use that exact text as the subject line, nothing else. Subject must include due datetime.\n  - message: The email body in text broken down into these parts, separated by double line breaks:\n\n  - Part 1 - Direct answer to the query (start here, no greeting)\n\n  - Part 2 - Why I'm qualified: I'm Zac Clifton, Senior DevOps Engineer at Waystar (2,000+ employees), leading enterprise software infrastructure systems in Healthcare. I cannot speak about Waystar specifically as I am under an NDA, however I can speak to generals\n  about the industry. In-depth skills in: Kubernetes/infrastructure, enterprise software architecture, SaaS founding, AI automation at scale.\n  LinkedIn: https://www.linkedin.com/in/cliftonz/\n  Articles: https://dev.to/cliftonz\n\n  - Part 3 - Availability: Monday through Saturday, 8am-8pm EST.\n  Best contact: zac16530@gmail.com | 502-794-3201\n\n  IMPORTANT: Always include the credentials block and contact info EXACTLY as written above at the end of every message. Do not omit or paraphrase it. No signature block beyond the contact info.\n"}},"id":"0caf60b6-0fc5-4000-93be-b4209862d6e3","name":"Generate Response Draft","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":3.1,"position":[3056,-672]},{"parameters":{"model":{"__rl":true,"value":"gpt-5","mode":"list","cachedResultName":"gpt-5"},"builtInTools":{"webSearch":{"searchContextSize":"high"}},"options":{}},"id":"ad2510cc-af99-43e3-b8c8-b6efc521b64e","name":"OpenAI GPT-4 for Response","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[3056,-256],"credentials":{"openAiApi":{"id":"QIZjLJ92uPOcCDE8","name":"OpenAi account"}}},{"parameters":{"schema":{"__rl":true,"mode":"name","value":"public"},"table":{"__rl":true,"mode":"name","value":"processed_haro_emails"},"columns":{"mappingMode":"defineBelow","value":{"processed_at":"={{ $now }}","email_id":"=${{ $('Get a message').item.json.id }}"},"matchingColumns":[],"schema":[{"id":"email_id","displayName":"email_id","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"processed_at","displayName":"processed_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"64d143c5-711c-448a-88b6-7d1c13e3e611","name":"Mark Email as Processed","type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[3216,-64],"executeOnce":true,"credentials":{"postgres":{"id":"dXDqCSpSeQj6nWD4","name":"Neon Home DB"}}},{"parameters":{"jsCode":"// Get emails from the trigger\nconst emails = $(\"Watch for HARO Emails\").all();\n\n// Get processed email IDs from database\nconst processedEmailIds = $(\"Get Processed HARO Email IDs\").all().map(item => item.json.email_id);\n\n// Filter out emails whose id exists in the processed list\nconst unprocessedEmails = emails.filter(email => {\n  return !processedEmailIds.includes(email.json.id);\n});\n\nreturn unprocessedEmails;"},"id":"6d0c493e-25ba-4760-9d3a-09e8b3430baa","name":"Filter Unprocessed Emails","type":"n8n-nodes-base.code","typeVersion":2,"position":[1296,-48]},{"parameters":{"operation":"get","messageId":"={{ $json.id }}","simple":false,"options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[1520,-48],"id":"18b7aed9-7ae0-42a5-9b65-73bc5296aecc","name":"Get a message","webhookId":"8fee9b57-c868-4fd7-8a34-d4cb49402450","credentials":{"gmailOAuth2":{"id":"UfGdgK49wgVcM0yE","name":"Zac Gmail"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-5.2","mode":"list","cachedResultName":"gpt-5.2"},"builtInTools":{},"options":{}},"id":"dc81e3df-18f4-4346-bed5-79414679a0b6","name":"OpenAI GPT-5.2","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.3,"position":[1808,-352],"credentials":{"openAiApi":{"id":"QIZjLJ92uPOcCDE8","name":"OpenAi account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[2656,-688],"id":"42704432-8c56-49cd-9506-bd37409e295e","name":"Loop Over Items"},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"to\": {\n    \"type\": \"string\"\n  },\n  \"subject\": {\n    \"type\": \"string\"\n  },\n  \"message\": {\n    \"type\": \"string\"\n  }\n}","autoFix":true},"id":"d7086cea-6c57-4c64-bc5e-82cae214803d","name":"Structure Opportunity Data1","type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[3232,-448]},{"parameters":{"jsCode":"const twentyFourHoursFromNow = new Date(Date.now() + 24 * 60 * 60 * 1000);\n\nreturn $input.all().flatMap(item =>\n  (item.json.output.opportunities || [])\n    .filter(opp => {\n      if (!opp.deadline) return true;\n      const dl = new Date(opp.deadline);\n      // Keep only if deadline is invalid (unparseable) or more than 24h away\n      return isNaN(dl.getTime()) || dl >= twentyFourHoursFromNow;\n    })\n    .map(opp => ({ json: opp }))\n);"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2416,-688],"id":"f80ee3bb-de37-4bf9-889e-8501fcd3f117","name":"Split Out Opportunities"},{"parameters":{"content":"## Database Setup (run against Neon Home DB)\n\n```sql\n-- 1. Processed emails tracking\nCREATE TABLE IF NOT EXISTS processed_haro_emails (\n  email_id TEXT PRIMARY KEY,\n  processed_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- 2. Enable pgvector\nCREATE EXTENSION IF NOT EXISTS vector;\n\n-- 3. Opportunities + feedback + embeddings\nCREATE TABLE IF NOT EXISTS haro_opportunities (\n  id SERIAL PRIMARY KEY,\n  email_id TEXT NOT NULL,\n  opportunity_hash TEXT UNIQUE NOT NULL,\n  query TEXT NOT NULL,\n  match_reason TEXT NOT NULL,\n  deadline TEXT,\n  contact_info TEXT,\n  generated_subject TEXT,\n  generated_message TEXT,\n  embedding vector(1536),\n  feedback_rating INTEGER,\n  feedback_received_at TIMESTAMPTZ,\n  created_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- 4. Vector similarity index\nCREATE INDEX IF NOT EXISTS haro_opp_embedding_idx\n  ON haro_opportunities\n  USING ivfflat (embedding vector_cosine_ops)\n  WITH (lists = 100);\n```","height":680,"width":420,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[32,-144],"id":"0eab17be-d57f-4788-8d9b-b2fb8d365da8","name":"DB Setup Note"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[1952,-192],"id":"7fc7e44b-f833-4f62-ae00-034a24b98030","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"QIZjLJ92uPOcCDE8","name":"OpenAi account"}}},{"parameters":{"mode":"retrieve-as-tool","toolDescription":"This tool has the feedback of past oppurtunities and \nquery, contact, match reason, generated response, 1536-dim embedding, and your good/bad/pending feedback rating","tableName":"haro_opportunity_vectors","options":{"columnNames":{"values":{}},"metadata":{"metadataValues":[{"name":"=user_email","value":"={{ $json.to }}"}]}}},"type":"@n8n/n8n-nodes-langchain.vectorStorePGVector","typeVersion":1.3,"position":[1952,-336],"id":"2bd57455-d0a1-4be3-8187-2764271751ca","name":"Postgres PGVector Store","credentials":{"postgres":{"id":"64vfs383hTo0m8pr","name":"NeonDB HBF account"}}},{"parameters":{"jsCode":"const crypto = require('crypto');\nconst item = $json;\nconst emailId = $('Get a message').first().json.id;\nconst userEmail = $('Get a message').first().json.to || 'default';\nconst oppId = crypto.randomUUID();\n\nreturn [{\n  json: {\n    pageContent: item.query,\n    metadata: {\n      opportunity_id: oppId,\n      user_email: userEmail,\n      match_reason: item.matchReason,\n      deadline: item.deadline,\n      contact_info: item.contactInfo,\n      email_id: emailId,\n      generated_subject: item.output ? item.output.subject : '',\n      generated_message: item.output ? item.output.message : '',\n      feedback_rating: null\n    }\n  }\n}];"},"id":"d81cea0f-6bb1-4fd7-ac10-21f57af6730e","name":"Prepare Document","type":"n8n-nodes-base.code","typeVersion":2,"position":[3376,-672]},{"parameters":{"model":"text-embedding-3-small","options":{}},"id":"eb7fff01-3414-418a-b542-4f8a637a2477","name":"OpenAI Embeddings Storage","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[3568,-464],"credentials":{"openAiApi":{"id":"QIZjLJ92uPOcCDE8","name":"OpenAi account"}}},{"parameters":{"resource":"draft","subject":"={{ $('Generate Response Draft').item.json.output.subject }}","message":"={{ $('Generate Response Draft').item.json.output.message }}\n\n---\n\nRate this match:\nGood Match: https://n8n.clifton.quest/form/21899513-a885-4f3f-8de3-0ab3d7c76440?Opportunity+ID={{ $('Prepare Document').item.json.metadata.opportunity_id }}&Rating=1\nBad Match: https://n8n.clifton.quest/form/21899513-a885-4f3f-8de3-0ab3d7c76440?Opportunity+ID={{ $('Prepare Document').item.json.metadata.opportunity_id }}&Rating=-1","options":{"sendTo":"={{ $('Generate Response Draft').item.json.output.To }}"}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[4048,-672],"id":"23857df4-d195-4673-8f5f-5c6f4abc592f","name":"Create a draft1","webhookId":"8e0302c3-6e7b-4b25-90f6-cae272985fe5","executeOnce":true,"credentials":{"gmailOAuth2":{"id":"UfGdgK49wgVcM0yE","name":"Zac Gmail"}}},{"parameters":{"mode":"insert","tableName":"haro_opportunity_vectors","options":{}},"id":"e08ced27-c142-459a-843f-46249561ad7e","name":"Store Opportunity1","type":"@n8n/n8n-nodes-langchain.vectorStorePGVector","typeVersion":1,"position":[3584,-672],"credentials":{"postgres":{"id":"dXDqCSpSeQj6nWD4","name":"Neon Home DB"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1.1,"position":[3760,-464],"id":"cce46164-9875-4f9b-bfa0-7e00847d1b25","name":"Default Data Loader"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":3},"conditions":[{"id":"bda05279-3af9-414c-bfcf-49e9f5e99eaf","leftValue":"={{ $('Split Out Opportunities').all().length }}","rightValue":0,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.3,"position":[3392,-64],"id":"19ff2898-3c09-4129-a2ea-7b1c5391eade","name":"If"},{"parameters":{"authentication":"webhook","content":"=Found ${{ $('Split Out Opportunities').all().length }} haro oppurtunities.","options":{}},"type":"n8n-nodes-base.discord","typeVersion":2,"position":[3632,-80],"id":"e082ad76-db84-4112-a83c-6a1e60d14c2f","name":"Discord","webhookId":"b76b3eb6-f02f-464c-8b45-23023a290e4f","credentials":{"discordWebhookApi":{"id":"itxZeAJbs9N1NxYG","name":"Zac Information Channel"}}},{"parameters":{"content":"## Vector Store: HARO Opportunity Memory\n\nUses n8n's PGVector Vector Store node with OpenAI text-embedding-3-small. Every matched opportunity is embedded and stored in the `haro_opportunity_vectors` table (auto-managed by n8n). Per-user segmentation via `user_email` in metadata (from Gmail address).\n\nWhen a new HARO email arrives, the workflow finds similar past opportunities via vector similarity. Ones with feedback are injected into the analysis prompt as calibration examples.\n\n**Metadata stored per opportunity:**\n- opportunity_id (uuid, for feedback links)\n- user_email (Gmail address, per-user filtering)\n- match_reason, deadline, contact_info\n- generated_subject, generated_message\n- feedback_rating: 1=good, -1=bad, null=pending\n\n---\n\n## Database Setup (run against Neon Home DB)\n\n```sql\nCREATE EXTENSION IF NOT EXISTS vector;\n\nCREATE TABLE IF NOT EXISTS processed_haro_emails (\n  email_id TEXT PRIMARY KEY,\n  processed_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- haro_opportunity_vectors is auto-created by\n-- the PGVector Vector Store node on first insert.\n-- Run these indexes AFTER the first insert:\n\nCREATE INDEX IF NOT EXISTS haro_vectors_user_email_idx\n  ON haro_opportunity_vectors\n  ((metadata->>'user_email'));\n\nCREATE INDEX IF NOT EXISTS haro_vectors_feedback_idx\n  ON haro_opportunity_vectors\n  ((metadata->>'feedback_rating'))\n  WHERE metadata->>'feedback_rating' IS NOT NULL;\n```","height":904,"width":596,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-272,624],"id":"7c4b7991-133c-481f-97ab-24718775d701","name":"DB Setup Note1"},{"parameters":{"minutesSaved":20},"type":"n8n-nodes-base.timeSaved","typeVersion":1,"position":[4288,-672],"id":"32e501d8-34f1-465f-9e7a-908ebb96a141","name":"Time Saved"},{"parameters":{"content":"# Note\n\nexecutes top to bottom"},"type":"n8n-nodes-base.stickyNote","position":[1488,-752],"typeVersion":1,"id":"9bc3c575-50b0-432a-9be5-09c4a4553737","name":"Sticky Note"},{"parameters":{"mode":"chooseBranch","useDataOfInput":2},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[3024,-64],"id":"9c46c1f9-cd8b-4545-8146-8628a3f70cbd","name":"Merge"}],"connections":{"Watch for HARO Emails":{"main":[[{"node":"Wait for Email Data and DB","type":"main","index":0},{"node":"Get Processed HARO Email IDs","type":"main","index":0}]]},"Get Processed HARO Email IDs":{"main":[[{"node":"Wait for Email Data and DB","type":"main","index":1}]]},"Wait for Email Data and DB":{"main":[[{"node":"Filter Unprocessed Emails","type":"main","index":0}]]},"Analyze HARO Opportunities":{"main":[[{"node":"Found Relevant Opportunities?","type":"main","index":0}]]},"Structure Opportunity Data":{"ai_outputParser":[[{"node":"Analyze HARO Opportunities","type":"ai_outputParser","index":0}]]},"Found Relevant Opportunities?":{"main":[[{"node":"Split Out Opportunities","type":"main","index":0}]]},"Generate Response Draft":{"main":[[{"node":"Prepare Document","type":"main","index":0}]]},"OpenAI GPT-4 for Response":{"ai_languageModel":[[{"node":"Generate Response Draft","type":"ai_languageModel","index":0},{"node":"Structure Opportunity Data1","type":"ai_languageModel","index":0}]]},"Filter Unprocessed Emails":{"main":[[{"node":"Get a message","type":"main","index":0}]]},"Get a message":{"main":[[{"node":"Analyze HARO Opportunities","type":"main","index":0},{"node":"Merge","type":"main","index":1}]]},"OpenAI GPT-5.2":{"ai_languageModel":[[{"node":"Analyze HARO Opportunities","type":"ai_languageModel","index":0}]]},"Loop Over Items":{"main":[[{"node":"Merge","type":"main","index":0}],[{"node":"Generate Response Draft","type":"main","index":0}]]},"Structure Opportunity Data1":{"ai_outputParser":[[{"node":"Generate Response Draft","type":"ai_outputParser","index":0}]]},"Split Out Opportunities":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Postgres PGVector Store":{"ai_tool":[[{"node":"Analyze HARO Opportunities","type":"ai_tool","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Postgres PGVector Store","type":"ai_embedding","index":0}]]},"Prepare Document":{"main":[[{"node":"Store Opportunity1","type":"main","index":0}]]},"OpenAI Embeddings Storage":{"ai_embedding":[[{"node":"Store Opportunity1","type":"ai_embedding","index":0}]]},"Create a draft1":{"main":[[{"node":"Time Saved","type":"main","index":0}]]},"Store Opportunity1":{"main":[[{"node":"Create a draft1","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Store Opportunity1","type":"ai_document","index":0}]]},"Mark Email as Processed":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Discord","type":"main","index":0}]]},"Time Saved":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Mark Email as Processed","type":"main","index":0}]]}},"authors":"Zac Clifton","name":"Version 01abc32d","description":"add \"to\" field for the ai output","autosaved":true,"workflowPublishHistory":[{"createdAt":"2026-02-11T20:13:17.729Z","id":29,"workflowId":"pZrIFVjEL_FbznFr5VQMV","versionId":"01abc32d-06a3-46aa-a509-792569e8bed2","event":"activated","userId":"ec0e00c1-c94c-415c-8a06-1d74c6c63f94"}]}}