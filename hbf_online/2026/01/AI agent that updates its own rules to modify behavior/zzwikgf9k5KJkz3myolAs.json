{"updatedAt":"2026-01-10T14:43:20.447Z","createdAt":"2026-01-10T14:43:20.447Z","id":"zzwikgf9k5KJkz3myolAs","name":"AI agent that updates its own rules to modify behavior","description":null,"active":false,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"={{ $json.body.message }}","options":{"systemMessage":"=# Overview\nYou are the ultimate personal assistant. Your job is to figure out the right tool to use, if applicable to the user's prompt.\n\n## Rules\n{{ \"- \" + $json.rules.join(\"\\n- \") }}\n\n## Rule Database Schema: \nTable name: datos_agent_rules\n[\n  {\n    \"column_name\": \"id\",\n    \"data_type\": \"bigint\",\n    \"character_maximum_length\": null,\n    \"is_nullable\": \"NO\",\n    \"column_default\": null\n  },\n  {\n    \"column_name\": \"created_at\",\n    \"data_type\": \"timestamp with time zone\",\n    \"character_maximum_length\": null,\n    \"is_nullable\": \"NO\",\n    \"column_default\": \"now()\"\n  },\n  {\n    \"column_name\": \"rule_text\",\n    \"data_type\": \"text\",\n    \"character_maximum_length\": null,\n    \"is_nullable\": \"YES\",\n    \"column_default\": null\n  },\n  {\n    \"column_name\": \"agent\",\n    \"data_type\": \"text\",\n    \"character_maximum_length\": null,\n    \"is_nullable\": \"YES\",\n    \"column_default\": null\n  }\n]\n\n## Final Context:\n- Here is the current date/time: {{ $now.toISO() }}\n- UNIX timestamp for current date/time: {{ $now.toMillis() }}\n- The user's timezone is PST\n- The user's name is Giovanni Segar (or Gio for short)","returnIntermediateSteps":true}},"id":"70bedb4b-6fe6-4cf0-86c5-e3c8e78fa256","name":"Ultimate Assistant1","type":"@n8n/n8n-nodes-langchain.agent","position":[1040,368],"typeVersion":1.7},{"parameters":{"contextWindowLength":10},"id":"53fc82b4-81d2-4e4d-8bdb-fb253a513626","name":"Chat History1","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","position":[1088,624],"typeVersion":1.3},{"parameters":{"model":"=claude-sonnet-4-20250514","options":{"temperature":0.2}},"id":"a7108939-61f7-40f1-8c35-8ed7410fc45a","name":"Anthropic Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatAnthropic","position":[912,624],"typeVersion":1.2},{"parameters":{"operation":"executeQuery","query":"SELECT rule_text FROM datos_agent_rules WHERE agent = 'TestAgent';","options":{}},"id":"6765ccef-d5ad-4040-9378-67fe0019e7c7","name":"Get rules from database","type":"n8n-nodes-base.postgres","position":[368,240],"typeVersion":2.6},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"id":"33e63152-923a-4b61-a9b1-71b8c43ba90d","name":"Merge","type":"n8n-nodes-base.merge","position":[816,368],"typeVersion":3.1},{"parameters":{"fieldsToAggregate":{"fieldToAggregate":[{"fieldToAggregate":"rule_text","renameField":true,"outputFieldName":"rules"}]},"options":{}},"id":"e0343829-da12-4ed7-a610-8353168a2562","name":"Aggregate","type":"n8n-nodes-base.aggregate","position":[592,240],"typeVersion":1},{"parameters":{"descriptionType":"manual","toolDescription":"This should be used when the user corrects you in some way to add a rule that will be included in the future prompts. This can be specific to a certain client or can be a general rule for how to do things. Make sure to let the user know if you added a rule.","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"mode":"list","value":"datos_agent_rules","cachedResultName":"datos_agent_rules"},"columns":{"value":{"agent":"TestAgent","rule_text":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('rule_text', `Write a simple reminder for the future based on the user's instructions. `, 'string') }}"},"schema":[{"id":"id","type":"number","display":true,"removed":true,"required":false,"displayName":"id","defaultMatch":true,"canBeUsedToMatch":true},{"id":"created_at","type":"dateTime","display":true,"removed":true,"required":false,"displayName":"created_at","defaultMatch":false,"canBeUsedToMatch":true},{"id":"rule_text","type":"string","display":true,"required":false,"displayName":"rule_text","defaultMatch":false,"canBeUsedToMatch":true},{"id":"agent","type":"string","display":true,"required":false,"displayName":"agent","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["id"],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"cae47efc-4063-412a-bdc4-366f1cdb5308","name":"Insert rule into database","type":"n8n-nodes-base.postgresTool","position":[1472,608],"typeVersion":2.6},{"parameters":{"descriptionType":"manual","toolDescription":"Use this to get rules and their IDs for modification, delete items, add multiple items, or any other operation not covered by the simple insert tool","operation":"executeQuery","query":"{{ $fromAI('valid_postgres_sql_query', 'Write any valid SQL query for the Postgres rule database.', 'string') }}","options":{}},"id":"edda3371-1237-405e-a76e-bda1e0253b80","name":"Execute query on rule database","type":"n8n-nodes-base.postgresTool","position":[1648,608],"typeVersion":2.6},{"parameters":{"options":{}},"id":"f5348ce3-3600-4dab-a784-6455fb9f53f2","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","position":[96,384],"webhookId":"8f2b6d22-043e-4dab-b39a-44a8bbef4694","typeVersion":1.1},{"parameters":{"content":"## Video walkthrough\n\n@[youtube](OwIFK-r-NtQ)\nhttps://www.youtube.com/watch?v=OwIFK-r-NtQ\n\n## Summary of agent\nThis agent can write and rewrite its own rules, allowing you to mold its behavior. It receives rules from a database as system instructions and has tools to create, edit, or delete them. This is a great baseline for new agent builds.\n\n## How to start using it\n\n### Option 1: With a Postgres database (e.g., Supabase)\n1.  **Supabase Schema:** Create a table (e.g., `agent_rules`) with the following columns:\n    *   `id`: `bigint` (Primary Key, auto-incrementing)\n    *   `created_at`: `timestamp with time zone` (Default: `now()`)\n    *   `rule_text`: `text`\n    *   `agent`: `text`\n2.  **Workflow Updates:**\n    *   Update the **Postgres credentials** in the \"Get rules from database,\" \"Insert rule into database,\" and \"Execute query on rule database\" nodes.\n    *   Update the `agent` value (currently 'TestAgent') in the \"Get rules from database\" and \"Insert rule into database\" nodes if you want a different agent name.\n    *   Update the **Anthropic API credentials**.\n\n### Option 2: With Google Sheets\n1.  **Google Sheet Setup:** Create a Google Sheet with columns for `rule_text` and `agent`.\n2.  **Workflow Updates:**\n    *   Example Google Sheets nodes are included. You will need to:\n        *   Connect your **Google Sheets credentials**.\n        *   Select your Google Sheet (with `rule_text` and `agent` columns) in all relevant Google Sheets nodes.\n        *   Replace the existing Postgres nodes (\"Get rules from database\", \"Insert rule into database\", \"Execute query on rule database\") with the configured Google Sheets nodes.\n    *   Update the `agent` value (currently 'TestAgent') in the Google Sheets nodes if you want a different agent name.\n    *   Update the **Anthropic API credentials**.\n    *   **Agent Instructions:** Update the agent's system message and remove the database schema section as it is no longer relevant","height":760,"width":1000},"id":"e154a1e8-0e6f-4e04-b97a-803ec33908ac","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-560,624],"typeVersion":1},{"parameters":{"content":"## Prefer Google Sheets? Here are nodes to replace Postgres","height":540,"width":1240,"color":4},"id":"1adbc807-44ce-4c35-800f-5dc0092e0aad","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[608,848],"typeVersion":1},{"parameters":{"documentId":{"__rl":true,"mode":"list","value":""},"sheetName":{"__rl":true,"mode":"list","value":""}},"id":"e6f9a9c7-a498-46b0-88ac-ef693288ec18","name":"Get rules from sheets","type":"n8n-nodes-base.googleSheets","position":[688,944],"typeVersion":4.6},{"parameters":{"descriptionType":"manual","toolDescription":"Use this to add rules to the google sheet","operation":"append","documentId":{"__rl":true,"mode":"list","value":""},"sheetName":{"__rl":true,"mode":"list","value":""}},"id":"728c29e0-bd0f-4237-823b-1ca01de880ef","name":"Add rule to sheet","type":"n8n-nodes-base.googleSheetsTool","position":[960,960],"typeVersion":4.6},{"parameters":{"descriptionType":"manual","toolDescription":"Use this to update an existing rule in the sheet","operation":"update","documentId":{"__rl":true,"mode":"list","value":""},"sheetName":{"__rl":true,"mode":"list","value":""}},"id":"41c75ff2-cbab-4ec7-b5ff-858d5abbecb4","name":"Update rule in sheet","type":"n8n-nodes-base.googleSheetsTool","position":[1136,960],"typeVersion":4.6},{"parameters":{"descriptionType":"manual","toolDescription":"Use this to delete an existing rule in the sheet","operation":"delete","documentId":{"__rl":true,"mode":"list","value":""},"sheetName":{"__rl":true,"mode":"list","value":""}},"id":"6fd802ea-84ae-49bd-8e56-f966509a21e8","name":"Delete rule in sheet","type":"n8n-nodes-base.googleSheetsTool","position":[1280,960],"typeVersion":4.6}],"connections":{"Merge":{"main":[[{"node":"Ultimate Assistant1","type":"main","index":0}]]},"Aggregate":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Chat History1":{"ai_memory":[[{"node":"Ultimate Assistant1","type":"ai_memory","index":0}]]},"Anthropic Chat Model":{"ai_languageModel":[[{"node":"Ultimate Assistant1","type":"ai_languageModel","index":0}]]},"Get rules from database":{"main":[[{"node":"Aggregate","type":"main","index":0}]]},"Insert rule into database":{"ai_tool":[[{"node":"Ultimate Assistant1","type":"ai_tool","index":0}]]},"When chat message received":{"main":[[{"node":"Merge","type":"main","index":1},{"node":"Get rules from database","type":"main","index":0}]]},"Execute query on rule database":{"ai_tool":[[{"node":"Ultimate Assistant1","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateId":"4694"},"pinData":{},"versionId":"9a874b26-9f15-44d8-8db7-08048f584b97","activeVersionId":null,"versionCounter":1,"triggerCount":0,"shared":[{"updatedAt":"2026-01-10T14:43:20.449Z","createdAt":"2026-01-10T14:43:20.449Z","role":"workflow:owner","workflowId":"zzwikgf9k5KJkz3myolAs","projectId":"pPfvO125ydUVIXPh","project":{"updatedAt":"2025-12-08T14:51:48.381Z","createdAt":"2025-12-08T14:51:42.916Z","id":"pPfvO125ydUVIXPh","name":"Alex   <alex@honeybearfinancials.com>","type":"personal","icon":null,"description":null,"creatorId":"b5c2bbf4-eb13-4025-80fb-2acb074cc668","projectRelations":[{"updatedAt":"2025-12-08T14:51:42.916Z","createdAt":"2025-12-08T14:51:42.916Z","userId":"b5c2bbf4-eb13-4025-80fb-2acb074cc668","projectId":"pPfvO125ydUVIXPh","user":{"updatedAt":"2026-01-19T05:12:42.000Z","createdAt":"2025-12-08T14:51:40.983Z","id":"b5c2bbf4-eb13-4025-80fb-2acb074cc668","email":"alex@honeybearfinancials.com","firstName":"Alex","lastName":" ","personalizationAnswers":null,"settings":{"userActivated":true,"userClaimedAiCredits":true,"easyAIWorkflowOnboarded":true,"firstSuccessfulWorkflowId":"AqqHC4HlzK2Gq3eR","userActivatedAt":1766876864154,"npsSurvey":{"responded":true,"lastShownAt":1768748391500}},"disabled":false,"mfaEnabled":false,"lastActiveAt":"2026-01-19","isPending":false}}]}}],"tags":[],"activeVersion":null}